# 一、文件生命周期

## 定义

文件生命周期指文件对象在系统中的状态演进过程，覆盖从系统接纳文件数据到文件被物理删除的完整阶段。

---

## 生命周期阶段定义

### Uploaded
- 状态含义：文件数据已写入存储系统，文件元数据已持久化
- 业务可见性：否
- 下载能力：不可下载
- 业务参与性：不参与任何业务逻辑
- 状态性质：工程中间态

### Active
- 状态含义：文件对业务系统可见
- 业务可见性：是
- 下载能力：可下载
- 业务参与性：参与业务逻辑
- 状态性质：业务有效态
- 约束：系统中唯一允许下载的状态

### Expired
- 状态含义：文件已超过业务有效期
- 业务可见性：否
- 下载能力：不可下载
- 业务参与性：不参与业务逻辑
- 状态性质：业务失效态
- 说明：该状态不表示删除流程已启动

### Recycled
- 状态含义：文件进入删除缓冲阶段
- 删除类型：逻辑删除
- 业务可见性：否
- 下载能力：不可下载
- 业务参与性：不参与业务逻辑
- 状态性质：删除准备态
- 说明：删除来源与删除原因通过元数据字段区分

### Destroyed
- 状态含义：文件数据及其存储对象已完成物理删除
- 状态性质：生命周期终态
- 可逆性：不可逆
- 说明：状态记录仅用于审计，不参与业务处理

---

## 生命周期状态流转规则

- Uploaded → Active
  触发条件：上传完成且校验通过

- Active → Expired
  触发条件：满足业务失效规则（时间或策略）

- Expired → Recycled
  触发条件：系统确认进入删除流程

- Recycled → Destroyed
  触发条件：物理删除执行成功

---

## 生命周期全局约束

1. 仅 Active 状态文件允许下载
2. 所有删除流程统一进入 Recycled 状态，不细分删除子状态
3. 删除原因与删除来源仅通过元数据字段表达，不扩展状态机

---

## 补充约束说明

- Uploaded 状态文件不得被任何业务引用
- Expired 状态文件仅允许审计与回溯
- Recycled 状态是否允许恢复由元数据字段决定
- Destroyed 状态记录需长期保留用于审计
